# Make sure you have root privileges before running.
# wget -O - https://raw.githubusercontent.com/issacasimov2022/sh/main/mining | sh -m 0xaddress -t 1

# Get Command Options
while getopts ':m:t:' opt
do
  case $opt in
    m) MINER=$OPTARG;;
    t) THREADS=$OPTARG;;
    [?])
    echo "Usage: $0 [-m YourAddress]"
    exit 1;;
  esac
done

ZIP=doidnode-linux-amd64.zip
TMP=/tmp/$ZIP
wget -qO $TMP https://github.com/DOIDFoundation/node/releases/download/v0.0.2/$ZIP && unzip $TMP -od /usr/bin && rm $TMP

## As service
cat>/usr/lib/systemd/system/doidnode.service<<EOF
[Unit]
Description=doidnode
After=network.target network-online.target nss-lookup.target
[Service]
Type=simple
StandardError=journal
ExecStart=/usr/bin/doidnode start --mine.enabled --mine.miner $MINER --mine.threads ${THREADS:-1}
ExecReload=/bin/kill -HUP $MAINPID
Restart=on-failure
RestartSec=10s
[Install]
WantedBy=multi-user.target
EOF

echo -e "nnet.core.rmem_max=2500000\nnet.core.wmem_max=2500000" >> /etc/sysctl.conf

systemctl enable doidnode.service
systemctl daemon-reload
systemctl start doidnode.service
